# NFR_BDD.md — Приёмка в формате Gherkin

``` f1
Feature: Безопасность аутентификации и защита от перебора
  Scenario: Успешное хэширование пароля с bcrypt
    Given система аутентификации настроена с cost factor = 12
    When пользователь регистрируется с паролем "12345678"
    Then пароль должен быть захэширован с использованием bcrypt
    And время хэширования должно быть >= 100 мс для защиты от перебора

  Scenario: Блокировка при multiple failed login attempts
    Given IP адрес 192.168.1.100
    When происходит 5 неуспешных попыток входа в течение 1 минуты
    Then шестая попытка входа должна возвращать HTTP 429 Too Many Requests
    And в логах должна быть запись о блокировке IP
```

``` f2
Feature: Валидация и целостность данных записей
  Scenario: Создание записи с валидными данными
    Given пользователь аутентифицирован
    When отправляется POST /entries с валидными title, link, kind="book", status="planned"
    Then система должна сохранить запись
    And ответ должен содержать HTTP 201 Created
    And время ответа p95 должно быть <= 500 мс

  Scenario: Отклонение записи с невалидным kind (негативный)
    Given пользователь аутентифицирован
    When отправляется POST /entries с kind="invalid_type"
    Then система должна вернуть HTTP 422 Unprocessable Entity
    And в ответе должно быть понятное сообщение об ошибке
    And запись не должна быть сохранена в базу

  Scenario: Отклонение слишком длинного title
    Given пользователь аутентифицирован
    When отправляется POST /entries с title длиной 300 символов
    Then система должна вернуть HTTP 422 Unprocessable Entity
    And в ошибке должно быть указано максимальное ограничение в 255 символов
```

``` f3
Feature: Изоляция данных и авторизация
  Scenario: Пользователь видит только свои записи
    Given есть пользователь №1 с 5 записями
    And есть пользователь №2 с 3 записями
    When №1 аутентифицируется и запрашивает GET /entries
    Then он получает только свои 5 записей
    And в ответе нет записей пользователя №2

  Scenario: Попытка доступа к чужой записи (негативный)
    Given есть запись ID=123 принадлежащая №1
    And пользователь №2 аутентифицирован
    When №2 пытается получить GET /entries/123
    Then система должна вернуть HTTP 404 Not Found
    And в логах должна быть запись о попытке несанкционированного доступа
```

``` f4
Feature: Производительность и надежность API
  Scenario: Быстрое получение списка записей под нагрузкой
    Given сервис развернут на staging с 1000 тестовых записей
    When запускается нагрузочный тест 20 RPS на GET /entries в течение 5 минут
    Then p95 времени ответа должен быть <= 200 мс
    And процент ошибок должен быть < 1%

  Scenario: Надежное создание записей
    Given сервис работает в нормальном режиме
    When отправляется 1000 последовательных запросов POST /entries
    Then success rate должен быть >= 99.5%
    And все созданные записи должны быть доступны для чтения
```

``` f5
Feature: Безопасность зависимостей и конфиденциальность
  Scenario: Отсутствие критических уязвимостей в зависимостях
    Given проект имеет зависимости из requirements.txt
    When запускается сканирование уязвимостей (safety/trivy)
    Then не должно быть найдено уязвимостей уровня High или Critical
    And CI/CD пайплайн должен завершиться успешно

  Scenario: Защита конфиденциальных данных в логах
    Given пользователь выполняет запрос с JWT токеном
    When запрос логируется
    Then токен должен быть маскирован
    And пароли не должны присутствовать в логах в открытом виде
```
